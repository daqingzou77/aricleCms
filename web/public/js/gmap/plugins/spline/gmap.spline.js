GMap.Spline=GMap.Polyline.extend({options:{tension:.5,numOfSegments:20,close:!1},initialize:function(t,n){GMap.Polyline.prototype.initialize.call(this,t,n),GMap.Util.setOptions(this,n)},_updatePath:function(){this._renderer._updateSpline(this)},_getSplinePoints:function(t){"use strict";function n(t,n,i){for(var o=1;o<i-2;o+=1)for(var a=t[o].x,r=t[o].y,p=t[o+1].x,u=t[o+1].y,f=(p-t[o-1].x)*e,c=(u-t[o-1].y)*e,_=(t[o+2].x-a)*e,y=(t[o+2].y-r)*e,g=0;g<s;g++){var v=g<<2,d=n[v],S=n[v+1],x=n[v+2],G=n[v+3];h[l++]=d*a+S*p+x*f+G*_,h[l++]=d*r+S*u+x*c+G*y}}var i,e=this.options.tension,s=this.options.numOfSegments,o=this.options.close,a=1,r=t.length,l=0,p=(2*r-2)*s+2+(o?2*s:0),h=new Float32Array(p),u=new Float32Array(4*(s+2)),f=4;i=t.slice(0),o?(i.unshift(t[r-1]),i.push(t[0])):(i.unshift(t[0]),i.push(t[r-1])),u[0]=1;for(var a=0;a<s;a++){var c=a/s,_=c*c,y=_*c,g=2*y,v=3*_;u[f++]=g-v+1,u[f++]=v-g,u[f++]=y-2*_+c,u[f++]=y-_}return u[++f]=1,n(i,u,r+2),o&&(i=[],i.push(t[r-2]),i.push(t[r-1]),i.push(t[0]),i.push(t[1]),n(i,u,4)),r=o?0:t.length-1,h[l++]=t[r].x,h[l]=t[r].y,h}}),GMap.Canvas.prototype._updateSpline=function(t){if(this._drawing&&!t.isEmpty()){this._drawnLayers[t._leaflet_id]=t;for(var n=this._ctx,i=t._rings.length,e=[],s=0;s<i;s++){var o=t._getSplinePoints(t._rings[s]);e.push(o)}for(n.beginPath(),s=0;s<i;s++){var o=e[s];for(j=2,len2=o.length;j<len2;j+=2)n[j?"lineTo":"moveTo"](o[j],o[j+1]);closed&&n.closePath()}this._fillStroke(n,t)}},GMap.spline=function(t,n){return new GMap.Spline(t,n)};